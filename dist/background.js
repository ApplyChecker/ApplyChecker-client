(()=>{"use strict";async function e(e){return(await chrome.cookies.getAll({domain:`.${e}`})).map((e=>`${e.name}=${e.value}`)).join("; ")}function t(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}chrome.runtime.onMessage.addListener(((a,r,c)=>"fetchWantedData"===a.action?(async function(){try{const t=Date.now();let a=[],r=0;const c=20;let o=!0;const s=await e("wanted.co.kr"),n=await async function(){try{const e=await chrome.storage.local.get(["cached_wanted_user_id","cached_wanted_user_id_timestamp"]),t=864e5;return e.cached_wanted_user_id&&e.cached_wanted_user_id_timestamp&&Date.now()-e.cached_wanted_user_id_timestamp<t?e.cached_wanted_user_id:async function(){try{const e=await chrome.storage.local.get("cached_wanted_user_id");if(e.cached_wanted_user_id)return e.cached_wanted_user_id;const t=await chrome.tabs.query({url:"https://*.wanted.co.kr/*"}),a=t[0]?.id;if(!a)throw new Error("Wanted 페이지를 열어주세요.");const r=await chrome.scripting.executeScript({target:{tabId:a},func:()=>{const e=Object.keys(localStorage).find((e=>e.startsWith("ab.storage.userId")));if(!e)return null;const t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t).v.g}catch{return null}}}),c=r[0]?.result;if(!c)throw new Error("userId를 찾을 수 없습니다. Wanted에 로그인되어 있는지 확인해주세요.");return await chrome.storage.local.set({cached_wanted_user_id:c,cached_wanted_user_id_timestamp:Date.now()}),c}catch(e){throw console.error("userId 추출 에러:",e),e}}()}catch(e){throw console.error("캐시된 userId 가져오기 실패:",e),e}}();for(console.log("userId",n);o;){const e=`https://www.wanted.co.kr/api/v1/applications?${t}&status=complete,+pass,+hire,+reject&sort=-apply_time,-create_time&user_id=${n}&end_date=&locale=ko-kr&includes=summary&q=&limit=${c}&offset=${r}&start_date=`,i=await fetch(e,{headers:{accept:"application/json, text/plain, */*","accept-language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7","cache-control":"no-cache",priority:"u=1, i","sec-ch-ua":'"Chromium";v="130", "Google Chrome";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","wanted-user-agent":"user-web","wanted-user-country":"KR","wanted-user-language":"ko",cookie:s,Referer:"https://www.wanted.co.kr/status/applications/applied?q&start_date=&end_date="},credentials:"include"});if(!i.ok)throw new Error(`원티드 API 요청 실패 (${i.status})`);const d=await i.json();if(!d.applications||0===d.applications.length)break;console.log("data",d),a=a.concat(d.applications),d.applications.length<c?o=!1:r+=c}return a.map((e=>({id:e.id,status:e.status,companyName:e.job.company_name,position:e.job.position,appliedDate:new Date(e.create_time).toLocaleDateString("ko-KR"),location:e.job.location,jobDetail:{reward:e.job.formatted_reward_total,category:e.job.category}})))}catch(e){throw console.error("Wanted error:",e),new Error(`원티드 데이터 가져오기 실패: ${e.message}`)}}().then((e=>{c({success:!0,data:e})})).catch((e=>{c({success:!1,error:e.message})})),!0):"fetchSaraminData"===a.action&&(async function(){try{await e("saramin.co.kr");const a=new Date,r=`https://www.saramin.co.kr/zf_user/persons/apply-status-list?status_type=&start_date=${t(new Date(a.setFullYear(a.getFullYear()-1)))}&end_date=${t(new Date)}&search_period=12&read_status=tot&recruit_status=tot&order_type=update&keyword=`,c=await fetch(r,{method:"GET",headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","accept-language":"ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7","cache-control":"max-age=0","sec-ch-ua":'"Chromium";v="130", "Google Chrome";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"same-origin","sec-fetch-user":"?1","upgrade-insecure-requests":"1"},credentials:"include"});if(!c.ok)throw new Error(`사람인 API 요청 실패 (${c.status})`);const o=await c.text();return console.log(o),o}catch(e){throw console.error("Saramin error:",e),new Error(`사람인 데이터 가져오기 실패: ${e.message}`)}}().then((e=>{c({success:!0,data:e})})).catch((e=>{c({success:!1,error:e.message})})),!0)))})();